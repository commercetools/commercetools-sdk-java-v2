<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) -->
<title>ClientTuning (commercetools Java SDK)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="declaration: package: com.commercetools.docs.meta, class: ClientTuning">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
<script type="text/javascript" src="../../../../script-dir/jquery-3.7.1.min.js"></script>
<script type="text/javascript" src="../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var pathtoroot = "../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../../help-doc.html#class">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor-summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor-detail">Constr</a>&nbsp;|&nbsp;</li>
<li>Method</li>
</ul>
</div>
<div class="nav-list-search"><label for="search-input">SEARCH:</label>
<input type="text" id="search-input" value="search" disabled="disabled">
<input type="reset" id="reset-button" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">com.commercetools.docs.meta</a></div>
<h1 title="Class ClientTuning" class="title">Class ClientTuning</h1>
</div>
<div class="inheritance" title="Inheritance Tree"><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html" title="class or interface in java.lang" class="external-link">java.lang.Object</a>
<div class="inheritance">com.commercetools.docs.meta.ClientTuning</div>
</div>
<section class="class-description" id="class-description">
<hr>
<div class="type-signature"><span class="modifiers">public class </span><span class="element-name type-name-label">ClientTuning</span>
<span class="extends-implements">extends <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></span></div>
<div class="block"><b>Table of content</b><ul><li><a href="#client-tuning">Tuning the client</a></li><ul><li><a href="#blocking-execution">Blocking execution</a></li><li><a href="#policy-middleware">PolicyMiddleware</a></li><li><a href="#configure-http-client">Configure the underlying http client</a></li><li><a href="#limit-requests">Limit concurrent requests</a></li><li><a href="#timeouts">Timeouts</a></li></ul></ul>
 <h2 id=client-tuning>Tuning the client</h2>

 <h3 id=blocking-execution>Blocking execution</h3>

 <p>In a lot of frameworks there is no support for asynchronous execution and so it is necessary to wait for the responses.
 The client can wait for responses with the method <a href="../../../../io/vrap/rmf/base/client/RequestCommand.html#executeBlocking()"><code>RequestCommand.executeBlocking()</code></a>. This method enforces a timeout for
 resilience and throws directly <a href="../../../../io/vrap/rmf/base/client/ApiHttpException.html" title="class in io.vrap.rmf.base.client"><code>ApiHttpException</code></a>.</p>

 <div id="example-ExamplesTest-executeBlocking--%s" class=code-example><pre><code class='java'>ProjectApiRoot apiRoot = createProjectClient();
Project project = apiRoot.get().executeBlocking().getBody();
</code><p>See the <a href="https://github.com/commercetools/commercetools-sdk-java-v2/blob/master/commercetools/internal-docs/src/test/java/example/ExamplesTest.java" target="_blank">test code</a>.</pre></div>

 <h3 id=policy-middleware>PolicyMiddleware</h3>

 <p>The <a href="../../../../io/vrap/rmf/base/client/http/PolicyMiddleware.html" title="interface in io.vrap.rmf.base.client.http"><code>PolicyMiddleware</code></a> configures a client to handle failures like gateway timeouts
 and version conflicts through retrying the request. Limiting the number of parallel requests or timeouts</p>

 <p>A best practice example to retry on gateway timeouts and similar problems.</p>

 <div id="example-ExamplesTest-retry--%s" class=code-example><pre><code class='java'>ProjectApiRoot apiRoot = ApiRootBuilder.of()
        .defaultClient(ClientCredentials.of().withClientId("clientId").withClientSecret("clientSecret").build(),
            ServiceRegion.GCP_EUROPE_WEST1)
        .withPolicies(policies -&gt; policies.withRetry(builder -&gt; builder.maxRetries(5)
                .statusCodes(Arrays.asList(BAD_GATEWAY_502, SERVICE_UNAVAILABLE_503, GATEWAY_TIMEOUT_504))))
        .build("my-project");
</code><p>See the <a href="https://github.com/commercetools/commercetools-sdk-java-v2/blob/master/commercetools/internal-docs/src/test/java/example/ExamplesTest.java" target="_blank">test code</a>.</pre></div>

 <p>For more configuration options see <a href="../../../../io/vrap/rmf/base/client/http/PolicyBuilder.html" title="class in io.vrap.rmf.base.client.http"><code>PolicyBuilder</code></a></p>

 <h3 id=configure-http-client>Configure the underlying http client</h3>

 <p>The <a href="../../api/defaultconfig/ApiRootBuilder.html" title="class in com.commercetools.api.defaultconfig"><code>ApiRootBuilder</code></a> has create methods which allow to pass a preconfigured HTTP client.</p>

 <div id="example-ExamplesTest-proxy--%s" class=code-example><pre><code class='java'>Proxy proxy = new Proxy(Proxy.Type.HTTP, new InetSocketAddress("proxy", 8080));
VrapHttpClient httpClient = new CtOkHttp4Client(builder -&gt; builder.proxy(proxy));

ProjectApiRoot apiRoot = ApiRootBuilder.of(httpClient)
        .defaultClient(ClientCredentials.of()
                .withClientId("your-client-id")
                .withClientSecret("your-client-secret")
                .withScopes("your-scopes")
                .build(),
            ServiceRegion.GCP_EUROPE_WEST1)
        .build("my-project");
</code><p>See the <a href="https://github.com/commercetools/commercetools-sdk-java-v2/blob/master/commercetools/internal-docs/src/test/java/example/ExamplesTest.java" target="_blank">test code</a>.</pre></div>

 <h3 id=limit-requests>Limit concurrent requests</h3>

 <p>By default the client is initialized with a ForkJoinPool. The underlying HTTP client may have it's own configuration for
 limiting the maximum number of requests. By default the OkHttp and Apache AsyncHTTP client will be configured for 64 maximum
 requests.</p>

 <p>To adjust this instantiate the HTTP client in the client builder</p>

 <div id="example-ExamplesTest-httpConcurrentLimitation--%s" class=code-example><pre><code class='java'>ApiRootBuilder.of(new CtOkHttp4Client(64, 64))
        // ...
        .build();

ApiRootBuilder.of(new CtApacheHttpClient(64, 64))
        // ...
        .build();
</code><p>See the <a href="https://github.com/commercetools/commercetools-sdk-java-v2/blob/master/commercetools/internal-docs/src/test/java/example/ExamplesTest.java" target="_blank">test code</a>.</pre></div>

 <p>Another option is to use a middleware which limits the number of requests. The SDK provides for this use case
 the <a href="../../../../io/vrap/rmf/base/client/http/QueueMiddleware.html" title="class in io.vrap.rmf.base.client.http"><code>QueueMiddleware</code></a>.</p>

 <div id="example-ExamplesTest-queueConcurrentLimitation--%s" class=code-example><pre><code class='java'>ApiRootBuilder.of()
        // ...
        .withPolicies(policies -&gt; policies.withBulkhead(64, Duration.ofSeconds(10)))
        .build();
</code><p>See the <a href="https://github.com/commercetools/commercetools-sdk-java-v2/blob/master/commercetools/internal-docs/src/test/java/example/ExamplesTest.java" target="_blank">test code</a>.</pre></div>

 <h3 id=timeouts>Timeouts</h3>

 <p>Underlying HTTP Clients are by default configured to timeout after 120 seconds. There are different ways to limit
 the time a call can take. One is to develop a middleware which times out when necessary. This also is the most flexible
 option as it leaves room to distinguish between different kind of requests like <a href="../../../../io/vrap/rmf/base/client/ApiHttpMethod.html#GET"><code>GET</code></a>
 requests should timeout after 10 seconds where as POST requests should timeout after 120 seconds. It's best to use a
 resilience library like <a href="https://failsafe.dev/">failsafe</a> to implement this functionality.</p>

 <div id="example-ExamplesTest-timeoutMiddleware--%s" class=code-example><pre><code class='java'>dev.failsafe.Timeout&lt;ApiHttpResponse&lt;byte[]&gt;&gt; timeout = dev.failsafe.Timeout
        .&lt;ApiHttpResponse&lt;byte[]&gt;&gt; builder(Duration.ofSeconds(10))
        .build();
FailsafeExecutor&lt;ApiHttpResponse&lt;byte[]&gt;&gt; failsafeExecutor = Failsafe.with(timeout);

ProjectApiRoot apiRoot = ApiRootBuilder.of()
        .defaultClient(ClientCredentials.of()
                .withClientId("your-client-id")
                .withClientSecret("your-client-secret")
                .build(),
            ServiceRegion.GCP_EUROPE_WEST1)
        .addMiddleware((request, next) -&gt; failsafeExecutor.getStageAsync(() -&gt; next.apply(request)))
        .build("my-project");
</code><p>See the <a href="https://github.com/commercetools/commercetools-sdk-java-v2/blob/master/commercetools/internal-docs/src/test/java/example/ExamplesTest.java" target="_blank">test code</a>.</pre></div>

 <p>Alternatively the underlying HTTP can be configured to timeout after a specified amount of time.</p>

 <div id="example-ExamplesTest-timeoutOkHttpClient--%s" class=code-example><pre><code class='java'>ProjectApiRoot apiRoot = ApiRootBuilder
        .of(new CtOkHttp4Client(builder -&gt; builder.callTimeout(Duration.ofSeconds(10))))
        .defaultClient(ClientCredentials.of()
                .withClientId("your-client-id")
                .withClientSecret("your-client-secret")
                .build(),
            ServiceRegion.GCP_EUROPE_WEST1)
        .build("my-project");
</code><p>See the <a href="https://github.com/commercetools/commercetools-sdk-java-v2/blob/master/commercetools/internal-docs/src/test/java/example/ExamplesTest.java" target="_blank">test code</a>.</pre></div>
 <div id="example-ExamplesTest-timeoutApacheHttpClient--%s" class=code-example><pre><code class='java'>RequestConfig config = RequestConfig.custom().setResponseTimeout(Timeout.ofSeconds(10)).build();
ProjectApiRoot apiRoot = ApiRootBuilder
        .of(new CtApacheHttpClient(builder -&gt; builder.setDefaultRequestConfig(config)))
        .defaultClient(ClientCredentials.of()
                .withClientId("your-client-id")
                .withClientSecret("your-client-secret")
                .build(),
            ServiceRegion.GCP_EUROPE_WEST1)
        .build("my-project");
</code><p>See the <a href="https://github.com/commercetools/commercetools-sdk-java-v2/blob/master/commercetools/internal-docs/src/test/java/example/ExamplesTest.java" target="_blank">test code</a>.</pre></div>

 <p>The third option is to use the timeout functionality of the futures</p>

 <div id="example-ExamplesTest-timeoutFuture--%s" class=code-example><pre><code class='java'>ProjectApiRoot apiRoot = createProjectClient();

apiRoot.get().execute().get(10, TimeUnit.SECONDS);
apiRoot.get().executeBlocking(Duration.ofSeconds(10));
</code><p>See the <a href="https://github.com/commercetools/commercetools-sdk-java-v2/blob/master/commercetools/internal-docs/src/test/java/example/ExamplesTest.java" target="_blank">test code</a>.</pre></div></div>
</section>
<section class="summary">
<ul class="summary-list">
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<li>
<section class="constructor-summary" id="constructor-summary">
<h2>Constructor Summary</h2>
<div class="caption"><span>Constructors</span></div>
<div class="summary-table two-column-summary">
<div class="table-header col-first">Constructor</div>
<div class="table-header col-last">Description</div>
<div class="col-constructor-name even-row-color"><code><a href="#%3Cinit%3E()" class="member-name-link">ClientTuning</a>()</code></div>
<div class="col-last even-row-color">&nbsp;</div>
</div>
</section>
</li>
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method-summary">
<h2>Method Summary</h2>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-java.lang.Object">Methods inherited from class&nbsp;java.lang.<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></h3>
<code><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#equals-java.lang.Object-" title="class or interface in java.lang" class="external-link">equals</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#getClass--" title="class or interface in java.lang" class="external-link">getClass</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#hashCode--" title="class or interface in java.lang" class="external-link">hashCode</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#notify--" title="class or interface in java.lang" class="external-link">notify</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#notifyAll--" title="class or interface in java.lang" class="external-link">notifyAll</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#toString--" title="class or interface in java.lang" class="external-link">toString</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#wait--" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#wait-long-" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#wait-long-int-" title="class or interface in java.lang" class="external-link">wait</a></code></div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<li>
<section class="constructor-details" id="constructor-detail">
<h2>Constructor Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="&lt;init&gt;()">
<h3>ClientTuning</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="element-name">ClientTuning</span>()</div>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
<footer role="contentinfo">
<hr>
<p class="legal-copy"><small><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><span id="custom-javascripts"></span><script src="../../../../resources/javascripts/main.js"></script><link rel="stylesheet" href="../../../../resources/stylesheets/main.css"></small></p>
</footer>
</div>
</div>
</body>
</html>
