<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) -->
<title>Migration (commercetools-java-sdks 14.7.0-SNAPSHOT API)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="declaration: package: com.commercetools.docs.meta, class: Migration">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript"></script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../help-doc.html#class">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor-summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor-detail">Constr</a>&nbsp;|&nbsp;</li>
<li>Method</li>
</ul>
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">com.commercetools.docs.meta</a></div>
<h1 title="Class Migration" class="title">Class Migration</h1>
</div>
<div class="inheritance" title="Inheritance Tree"><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html" title="class or interface in java.lang" class="external-link">java.lang.Object</a>
<div class="inheritance">com.commercetools.docs.meta.Migration</div>
</div>
<section class="class-description" id="class-description">
<hr>
<div class="type-signature"><span class="modifiers">public class </span><span class="element-name"><a href="../../../../src-html/com/commercetools/docs/meta/Migration.html#line-146">Migration</a></span>
<span class="extends-implements">extends <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></span></div>
<div class="block"><b>Table of content</b><ul><li><a href="#compatibility-module">SDK v1 compatibility module</a></li><li><a href="#client-configuration-and-creation">Client Configuration and Creation</a></li><li><a href="#timout-setting">Timeout Setting</a></li><li><a href="#headers">Headers</a></li><li><a href="#retry">Retry</a></li><li><a href="#draft-builder">Draft Builder</a></li><li><a href="#create-command">Create Command</a></li><li><a href="#create-from-json">Create From Json</a></li><li><a href="#update-command">Update Command</a></li><li><a href="#query-getbyid">Query - GetById</a></li><li><a href="#query">Query</a></li></ul>
 <h2 id="compatibility-module">SDK v1 compatibility module</h2>

 <p>The SDK provides a compatibility module. This module e.g. allows the usage of the SDKv2 client
 with in conjunction with all the commands of the SDKv1. For more details please see <a href="Compatibility.html" title="class in com.commercetools.docs.meta"><code>Compatibility</code></a></p>

 <h2 id="client-configuration-and-creation">Client Configuration and Creation</h2>

 <p>From the 1.x we substitute the <strong>SphereClientFactory</strong> class with the <strong>ApiRootBuilder</strong> class in the 2.x.</p>

 <p>The benefit is that after the <strong>ApiRootBuilder</strong> has been defined, it's easy to create the requests directly from it.
 There are example below that can clarify the behaviour.</p>

 <p>
     <b>v1</b>
     <div id="example-MigrationV1-configuration--%s" class=code-example><pre><code class='java'>final SphereClient sphereClient = SphereClientFactory.of()
        .createClient("projectKey", "clientId", "clientSecret");
</code><p>See the <a href="https://github.com/commercetools/commercetools-sdk-java-v2/blob/master/commercetools/internal-docs/src/test/java/example/MigrationV1.java" target="_blank">test code</a>.</pre></div>
     <b>v2</b>
     <div id="example-MigrationV2-configuration--%s" class=code-example><pre><code class='java'>final ProjectApiRoot projectRoot = ApiRootBuilder.of()
        .defaultClient(ClientCredentials.of().withClientId("clientId").withClientSecret("clientSecret").build(),
            ServiceRegion.GCP_EUROPE_WEST1.getOAuthTokenUrl(), ServiceRegion.GCP_EUROPE_WEST1.getApiUrl())
        .build("projectKey");
</code><p>See the <a href="https://github.com/commercetools/commercetools-sdk-java-v2/blob/master/commercetools/internal-docs/src/test/java/example/MigrationV2.java" target="_blank">test code</a>.</pre></div>
 </p>

 <h2 id="timout-setting">Timeout Setting</h2>

 <p>In both versions is the <strong>executeBlocking()</strong> method that sets the timeout.</p>

 <p>
     <b>v1</b>
     <div id="example-MigrationV1-timeoutSettings--%s" class=code-example><pre><code class='java'>PagedQueryResult&lt;Category&gt; response = blockingClient.executeBlocking(CategoryQuery.of(), 45, TimeUnit.SECONDS);
</code><p>See the <a href="https://github.com/commercetools/commercetools-sdk-java-v2/blob/master/commercetools/internal-docs/src/test/java/example/MigrationV1.java" target="_blank">test code</a>.</pre></div>
     <b>v2</b>
     <div id="example-MigrationV2-timeoutSettings--%s" class=code-example><pre><code class='java'>CategoryPagedQueryResponse response = projectApiRoot.categories()
        .get()
        .executeBlocking(Duration.ofSeconds(45))
        .getBody();
</code><p>See the <a href="https://github.com/commercetools/commercetools-sdk-java-v2/blob/master/commercetools/internal-docs/src/test/java/example/MigrationV2.java" target="_blank">test code</a>.</pre></div>
 </p>

 <h2 id="headers">Headers</h2>

 <p>To set headers, in the 1.x there is the <strong>HttpRequest</strong> class and in the 2.x the <strong>ApiHttpRequest</strong> class.</p>

 <p>The main difference, as you can see the example below, is that the <strong>ApiHttpRequest</strong> can be directly instantiated and it
 can be directly set the type of method (GET or POST), the URI, the headers and the body.</p>

 <p>
     <b>v1</b>
     <pre>There is no way to set the header directly in the request</pre>
     <b>v2</b>
     <div id="example-MigrationV2-headers--%s" class=code-example><pre><code class='java'>final CartPagedQueryResponse carts = projectApiRoot.carts()
        .get()
        .addHeader("foo", "bar")
        .executeBlocking()
        .getBody();
</code><p>See the <a href="https://github.com/commercetools/commercetools-sdk-java-v2/blob/master/commercetools/internal-docs/src/test/java/example/MigrationV2.java" target="_blank">test code</a>.</pre></div>
 </p>

 <h2 id="retry">Retry</h2>

 <p>In the examples below there is a huge difference about the *Retry* for the v1 and v2.</p>

 <p>As can be seen, in the v1, it has to be define piece by piece: the retry rules, then the
 <strong>SphereClient</strong> and then the request in this case <strong>PagedQueryResult</strong>.</p>

 <p>On the contrary in the v2, the setup of the request can be built directly during the client creation,
 so we are going to have the <strong>ByProjectKeyRequestBuilder</strong> built including the setting of the Retry
 through the <strong>RetryMiddleware</strong> and as a plus, like in this case, it is possible to set up other
 parameters to our request like the logger <strong>InternalLoggerFactory</strong>. After that, we will have our
 request <strong>CategoryPagedQueryResponse</strong>.</p>

 <p>
     <b>v1</b>
     <div id="example-MigrationV1-retry--%s" class=code-example><pre><code class='java'>final int maxAttempts = 5;
final List&lt;RetryRule&gt; retryRules = Collections.singletonList(RetryRule.of(
    RetryPredicate.ofMatchingStatusCodes(BAD_GATEWAY_502, SERVICE_UNAVAILABLE_503, GATEWAY_TIMEOUT_504),
    RetryAction.ofExponentialBackoff(maxAttempts, 100, 2000)));
final SphereClient client = RetrySphereClientDecorator.of(sphereClient, retryRules);

final PagedQueryResult&lt;Category&gt; categoryPagedQueryResult = client.execute(CategoryQuery.of())
        .toCompletableFuture()
        .get();
</code><p>See the <a href="https://github.com/commercetools/commercetools-sdk-java-v2/blob/master/commercetools/internal-docs/src/test/java/example/MigrationV1.java" target="_blank">test code</a>.</pre></div>
     <b>v2</b>
     <div id="example-MigrationV2-retry--%s" class=code-example><pre><code class='java'>final ProjectApiRoot projectClient = ApiRootBuilder.of()
        .defaultClient(ServiceRegion.GCP_EUROPE_WEST1.getApiUrl(),
            ClientCredentials.of().withClientId("clientId").withClientSecret("clientSecret").build(),
            ServiceRegion.GCP_EUROPE_WEST1.getOAuthTokenUrl())
        .withRetryMiddleware(5, Arrays.asList(BAD_GATEWAY_502, SERVICE_UNAVAILABLE_503, GATEWAY_TIMEOUT_504))
        .build("projectKey");

final CategoryPagedQueryResponse body = projectClient.categories().get().executeBlocking().getBody();
</code><p>See the <a href="https://github.com/commercetools/commercetools-sdk-java-v2/blob/master/commercetools/internal-docs/src/test/java/example/MigrationV2.java" target="_blank">test code</a>.</pre></div>
 </p>

 <h2 id="draft-builder">Draft Builder</h2>

 <p>About the *DraftBuilder* the main difference is that in the 2.x there are not inheritances for the *DraftBuilder* classes,
 but there are no so much differences in the behaviour.</p>

 <p>
     <b>v1</b>
     <div id="example-MigrationV1-draftBuilder--%s" class=code-example><pre><code class='java'>LocalizedString name = LocalizedString.ofEnglish("name");
LocalizedString slug = LocalizedString.ofEnglish("slug");
LocalizedString metaDescription = LocalizedString.ofEnglish("metaDescription");
LocalizedString metaTitle = LocalizedString.ofEnglish("metaTitle");
LocalizedString metaKeywords = LocalizedString.ofEnglish("metaKeywords");
CategoryDraft categoryDraft = CategoryDraftBuilder.of(name, slug)
        .metaDescription(metaDescription)
        .metaTitle(metaTitle)
        .metaKeywords(metaKeywords)
        .externalId("externalId")
        .build();
</code><p>See the <a href="https://github.com/commercetools/commercetools-sdk-java-v2/blob/master/commercetools/internal-docs/src/test/java/example/MigrationV1.java" target="_blank">test code</a>.</pre></div>
     <b>v2</b>
     <div id="example-MigrationV2-draftBuilder--%s" class=code-example><pre><code class='java'>LocalizedString name = LocalizedString.ofEnglish("name");
LocalizedString slug = LocalizedString.ofEnglish("slug");
LocalizedString metaDescription = LocalizedString.ofEnglish("metaDescription");
LocalizedString metaTitle = LocalizedString.ofEnglish("metaTitle");
LocalizedString metaKeywords = LocalizedString.ofEnglish("metaKeywords");

CategoryDraft categoryDraft = CategoryDraftBuilder.of()
        .name(name)
        .slug(slug)
        .externalId("externalId")
        .metaTitle(metaTitle)
        .metaDescription(metaDescription)
        .metaKeywords(metaKeywords)
        .build();
</code><p>See the <a href="https://github.com/commercetools/commercetools-sdk-java-v2/blob/master/commercetools/internal-docs/src/test/java/example/MigrationV2.java" target="_blank">test code</a>.</pre></div>
 </p>

 <h2 id="create-command">Create Command</h2>

 <p>In the v2 there are not dedicated classes for the <strong>Create Command</strong>, but there are builders (you can see better in the
 <a href="#update-command">Update Command</a>. It means that to have a request it needs to have a draft to build which has to be passed
 into the <strong>post()</strong> method.</p>

 <p>
     <b>v1</b>
     <div id="example-MigrationV1-createCommand--%s" class=code-example><pre><code class='java'>LocalizedString name = LocalizedString.ofEnglish("name");
LocalizedString slug = LocalizedString.ofEnglish("slug");
CategoryDraft categoryDraft = CategoryDraftBuilder.of(name, slug).build();
Category category = blockingClient.executeBlocking(CategoryCreateCommand.of(categoryDraft));
</code><p>See the <a href="https://github.com/commercetools/commercetools-sdk-java-v2/blob/master/commercetools/internal-docs/src/test/java/example/MigrationV1.java" target="_blank">test code</a>.</pre></div>
     <b>v2</b>
     <div id="example-MigrationV2-createCommand--%s" class=code-example><pre><code class='java'>LocalizedString name = LocalizedString.ofEnglish("name");
LocalizedString slug = LocalizedString.ofEnglish("slug");
CategoryDraft categoryDraft = CategoryDraftBuilder.of().name(name).slug(slug).build();
Category category = projectApiRoot.categories().post(categoryDraft).executeBlocking().getBody();
</code><p>See the <a href="https://github.com/commercetools/commercetools-sdk-java-v2/blob/master/commercetools/internal-docs/src/test/java/example/MigrationV2.java" target="_blank">test code</a>.</pre></div>
 </p>

 <h2 id="create-from-json">Create From Json</h2>

 <p>The main difference in this case is that we replaced the <a href="https://commercetools.github.io/commercetools-jvm-sdk/apidocs/io/sphere/sdk/json/SphereJsonUtils.html" title="class or interface in io.sphere.sdk.json" class="external-link"><code>SphereJsonUtils</code></a> class with the <a href="../../../../io/vrap/rmf/base/client/utils/json/JsonUtils.html" title="class in io.vrap.rmf.base.client.utils.json"><code>JsonUtils</code></a> class.</p>

 <p>
     <b>v1</b>
     <div id="example-MigrationV1-fromJson--%s" class=code-example><pre><code class='java'>final CategoryDraft categoryDraft = SphereJsonUtils.readObjectFromResource("category.json",
    CategoryDraft.class);
final Category category = blockingClient.executeBlocking(CategoryCreateCommand.of(categoryDraft));
</code><p>See the <a href="https://github.com/commercetools/commercetools-sdk-java-v2/blob/master/commercetools/internal-docs/src/test/java/example/MigrationV1.java" target="_blank">test code</a>.</pre></div>
     <b>v2</b>
     <div id="example-MigrationV2-fromJson--%s" class=code-example><pre><code class='java'>final CategoryDraft categoryDraft = JsonUtils.fromJsonString(TestUtils.stringFromResource("category.json"),
    CategoryDraft.class);
final Category category = projectApiRoot.categories().post(categoryDraft).executeBlocking().getBody();
</code><p>See the <a href="https://github.com/commercetools/commercetools-sdk-java-v2/blob/master/commercetools/internal-docs/src/test/java/example/MigrationV2.java" target="_blank">test code</a>.</pre></div>
 </p>

 <h2 id="update-command">Update Command</h2>

 <p>Like the <a href="#create-command">Create Command</a>, there are not dedicated classes for the *Update Command*, but the use of
 the <strong>UpdateBuilder</strong> to create the type of update action to apply in the <strong>post</strong> method is substantial
 to build the update action.</p>

 <p>Here the differences:</p>

 <p>
     <b>v1</b>
     <div id="example-MigrationV1-updateCommand--%s" class=code-example><pre><code class='java'>LocalizedString newName = LocalizedString.ofEnglish("new name");
CategoryUpdateCommand command = CategoryUpdateCommand.of(category,
    Collections.singletonList(ChangeName.of(newName)));
Category updatedCategory = blockingClient.executeBlocking(command);
</code><p>See the <a href="https://github.com/commercetools/commercetools-sdk-java-v2/blob/master/commercetools/internal-docs/src/test/java/example/MigrationV1.java" target="_blank">test code</a>.</pre></div>
     <b>v2</b>
     <div id="example-MigrationV2-updateCommand--%s" class=code-example><pre><code class='java'>LocalizedString newName = LocalizedString.ofEnglish("new name");
CategoryUpdate categoryUpdate = CategoryUpdateBuilder.of()
        .version(category.getVersion())
        .actions(CategoryChangeNameActionBuilder.of().name(newName).build())
        .build();

Category updatedCategory = projectApiRoot.categories()
        .withId(category.getId())
        .post(categoryUpdate)
        .executeBlocking()
        .getBody();
</code><p>See the <a href="https://github.com/commercetools/commercetools-sdk-java-v2/blob/master/commercetools/internal-docs/src/test/java/example/MigrationV2.java" target="_blank">test code</a>.</pre></div>
 </p>

 <h2 id="query-getbyid">Query - GetById</h2>

 <p>In case of query by Id, the v2 is not so different from the previous cases, except that it uses the <strong>get</strong>
 method before other ways to filter our request.</p>

 <p>
     <b>v1</b>
     <div id="example-MigrationV1-queryById--%s" class=code-example><pre><code class='java'>Category loadedCategory = blockingClient
        .executeBlocking(CategoryByIdGet.of(category.getId()).withExpansionPaths(m -&gt; m.parent()));
</code><p>See the <a href="https://github.com/commercetools/commercetools-sdk-java-v2/blob/master/commercetools/internal-docs/src/test/java/example/MigrationV1.java" target="_blank">test code</a>.</pre></div>
     <b>v2</b>
     <div id="example-MigrationV2-queryById--%s" class=code-example><pre><code class='java'>Category queriedCategory = projectApiRoot.categories()
        .withId(category.getId())
        .get()
        .withExpand("parent")
        .executeBlocking()
        .getBody();
</code><p>See the <a href="https://github.com/commercetools/commercetools-sdk-java-v2/blob/master/commercetools/internal-docs/src/test/java/example/MigrationV2.java" target="_blank">test code</a>.</pre></div>
 </p>

 <h2 id="query">Query</h2>

 <p>To continue the previous case, to build complex query we use <strong><a href="../../api/models/ResourcePagedQueryResponse.html" title="interface in com.commercetools.api.models"><code>ResourcePagedQueryResponse</code></a>
 (in the v1 is <a href="https://commercetools.github.io/commercetools-jvm-sdk/apidocs/io/sphere/sdk/queries/PagedQueryResult.html" title="class or interface in io.sphere.sdk.queries" class="external-link"><code>PagedQueryResult</code></a>)</strong> which is meant to apply limit, count, total, offset, and result
 to our query. And the structure as the example before is to use <strong>get</strong> before other ways to filter our request.</p>

 <p>
     <b>v1</b>
     <div id="example-MigrationV1-query--%s" class=code-example><pre><code class='java'>PagedQueryResult&lt;Category&gt; pagedQueryResult = blockingClient.executeBlocking(CategoryQuery.of().byId("id123"));
</code><p>See the <a href="https://github.com/commercetools/commercetools-sdk-java-v2/blob/master/commercetools/internal-docs/src/test/java/example/MigrationV1.java" target="_blank">test code</a>.</pre></div>
     <b>v2</b>
     <div id="example-MigrationV2-query--%s" class=code-example><pre><code class='java'>CategoryPagedQueryResponse response = projectApiRoot.categories()
        .get()
        .withWhere("id = :id", "id", "id123")
        .executeBlocking()
        .getBody();
</code><p>See the <a href="https://github.com/commercetools/commercetools-sdk-java-v2/blob/master/commercetools/internal-docs/src/test/java/example/MigrationV2.java" target="_blank">test code</a>.</pre></div>
 </p></div>
</section>
<section class="summary">
<ul class="summary-list">
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<li>
<section class="constructor-summary" id="constructor-summary">
<h2>Constructor Summary</h2>
<div class="caption"><span>Constructors</span></div>
<div class="summary-table two-column-summary">
<div class="table-header col-first">Constructor</div>
<div class="table-header col-last">Description</div>
<div class="col-constructor-name even-row-color"><code><a href="#%3Cinit%3E()" class="member-name-link">Migration</a>()</code></div>
<div class="col-last even-row-color">&nbsp;</div>
</div>
</section>
</li>
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method-summary">
<h2>Method Summary</h2>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-java.lang.Object">Methods inherited from class&nbsp;java.lang.<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></h3>
<code><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#equals-java.lang.Object-" title="class or interface in java.lang" class="external-link">equals</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#getClass--" title="class or interface in java.lang" class="external-link">getClass</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#hashCode--" title="class or interface in java.lang" class="external-link">hashCode</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#notify--" title="class or interface in java.lang" class="external-link">notify</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#notifyAll--" title="class or interface in java.lang" class="external-link">notifyAll</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#toString--" title="class or interface in java.lang" class="external-link">toString</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#wait--" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#wait-long-" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#wait-long-int-" title="class or interface in java.lang" class="external-link">wait</a></code></div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<li>
<section class="constructor-details" id="constructor-detail">
<h2>Constructor Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="&lt;init&gt;()">
<h3>Migration</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="element-name"><a href="../../../../src-html/com/commercetools/docs/meta/Migration.html#line-146">Migration</a></span>()</div>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
<footer role="contentinfo">
<hr>
<p class="legal-copy"><small><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/default.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><span id="custom-javascripts"></span><script src="../../../../resources/javascripts/main.js"></script><link rel="stylesheet" href="../../../../resources/stylesheets/main.css"></small></p>
</footer>
</div>
</div>
</body>
</html>
