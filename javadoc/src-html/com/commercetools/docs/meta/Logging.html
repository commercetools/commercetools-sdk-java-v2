<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (16) -->
<title>Source code</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="source: package: com.commercetools.docs.meta, class: Logging">
<meta name="generator" content="javadoc/SourceToHTMLConverter">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
</head>
<body class="source-page">
<main role="main">
<div class="source-container">
<pre><span class="source-line-no">001</span><span id="line.1"></span>
<span class="source-line-no">002</span><span id="line.2">package com.commercetools.docs.meta;</span>
<span class="source-line-no">003</span><span id="line.3"></span>
<span class="source-line-no">004</span><span id="line.4">import java.util.Map;</span>
<span class="source-line-no">005</span><span id="line.5"></span>
<span class="source-line-no">006</span><span id="line.6">import io.vrap.rmf.base.client.http.InternalLoggerFactory;</span>
<span class="source-line-no">007</span><span id="line.7"></span>
<span class="source-line-no">008</span><span id="line.8">import org.slf4j.event.Level;</span>
<span class="source-line-no">009</span><span id="line.9"></span>
<span class="source-line-no">010</span><span id="line.10">/**</span>
<span class="source-line-no">011</span><span id="line.11"> * {@include.toc}</span>
<span class="source-line-no">012</span><span id="line.12"> * &lt;h2 id=logging&gt;Logging&lt;/h2&gt;</span>
<span class="source-line-no">013</span><span id="line.13"> *</span>
<span class="source-line-no">014</span><span id="line.14"> * &lt;p&gt;Internal logging used by the commercetools Composable Commerce client itself. Uses slf4j logger named {@code commercetools}.&lt;/p&gt;</span>
<span class="source-line-no">015</span><span id="line.15"> *</span>
<span class="source-line-no">016</span><span id="line.16"> * &lt;h2 id=logger-configuration&gt;Logger configuration&lt;/h2&gt;</span>
<span class="source-line-no">017</span><span id="line.17"> *</span>
<span class="source-line-no">018</span><span id="line.18"> * &lt;p&gt;The {@link io.vrap.rmf.base.client.ClientBuilder} allows the customization of the log levels used for different events. By default responses</span>
<span class="source-line-no">019</span><span id="line.19"> * will be logged with {@link org.slf4j.event.Level#INFO} and errors with {@link org.slf4j.event.Level#ERROR}. The</span>
<span class="source-line-no">020</span><span id="line.20"> * {@link io.vrap.rmf.base.client.ClientBuilder#withInternalLoggerFactory(InternalLoggerFactory, Level, Level, Level, Map)} method can be used</span>
<span class="source-line-no">021</span><span id="line.21"> * to change these defaults. Please see also {@link io.vrap.rmf.base.client.http.InternalLoggerMiddleware} for further details&lt;/p&gt;</span>
<span class="source-line-no">022</span><span id="line.22"> *</span>
<span class="source-line-no">023</span><span id="line.23"> * {@include.example example.ExamplesTest#loggingConfiguration}</span>
<span class="source-line-no">024</span><span id="line.24"> *</span>
<span class="source-line-no">025</span><span id="line.25"> * &lt;h2 id=log-information&gt;Log Information&lt;/h2&gt;</span>
<span class="source-line-no">026</span><span id="line.26"> *</span>
<span class="source-line-no">027</span><span id="line.27"> * The default logger middleware logs following information per level:</span>
<span class="source-line-no">028</span><span id="line.28"> *</span>
<span class="source-line-no">029</span><span id="line.29"> * &lt;h3&gt;Error&lt;/h3&gt;</span>
<span class="source-line-no">030</span><span id="line.30"> *</span>
<span class="source-line-no">031</span><span id="line.31"> * In case of an {@link io.vrap.rmf.base.client.ApiHttpException} the requests HTTP method name, URI and response status code</span>
<span class="source-line-no">032</span><span id="line.32"> * will be logged. For any other exception happening the cause and the exception will be logged.</span>
<span class="source-line-no">033</span><span id="line.33"> *</span>
<span class="source-line-no">034</span><span id="line.34"> * &lt;h3&gt;Info&lt;/h3&gt;</span>
<span class="source-line-no">035</span><span id="line.35"> *</span>
<span class="source-line-no">036</span><span id="line.36"> * &lt;p&gt;By default any response by the API will be logged with the requests HTTP method name, URI and response status code.</span>
<span class="source-line-no">037</span><span id="line.37"> * In case a deprecation header was submitted in the response an info entry with the deprecation notice will be logged.&lt;/p&gt;</span>
<span class="source-line-no">038</span><span id="line.38"> *</span>
<span class="source-line-no">039</span><span id="line.39"> * &lt;p&gt;The used log level for these events can be configured while instantiating the InternalLoggerMiddleware.&lt;/p&gt;</span>
<span class="source-line-no">040</span><span id="line.40"> *</span>
<span class="source-line-no">041</span><span id="line.41"> * &lt;h3&gt;Debug&lt;/h3&gt;</span>
<span class="source-line-no">042</span><span id="line.42"> *</span>
<span class="source-line-no">043</span><span id="line.43"> * &lt;p&gt;The request and the response object will be logged as a string representation including headers and body. Sensitive</span>
<span class="source-line-no">044</span><span id="line.44"> * data like auth token and passwords will be redacted.&lt;/p&gt;</span>
<span class="source-line-no">045</span><span id="line.45"> *</span>
<span class="source-line-no">046</span><span id="line.46"> * &lt;h3&gt;Trace&lt;/h3&gt;</span>
<span class="source-line-no">047</span><span id="line.47"> *</span>
<span class="source-line-no">048</span><span id="line.48"> * &lt;/p&gt;The request and response will be logged with a pretty printed output.  Sensitive data like auth token and passwords</span>
<span class="source-line-no">049</span><span id="line.49"> * will be redacted.&lt;/p&gt;</span>
<span class="source-line-no">050</span><span id="line.50"> *</span>
<span class="source-line-no">051</span><span id="line.51"> * &lt;h2 id=logger-hierarchy&gt;Logger hierarchy&lt;/h2&gt;</span>
<span class="source-line-no">052</span><span id="line.52"> *</span>
<span class="source-line-no">053</span><span id="line.53"> * &lt;p&gt;The loggers form a hierarchy separated by a dot. The root logger is {@code commercetools}.&lt;/p&gt;</span>
<span class="source-line-no">054</span><span id="line.54"> *</span>
<span class="source-line-no">055</span><span id="line.55"> * &lt;p&gt;The child loggers of commercetools Composable Commerce correspond with the names of the API endpoints, so for example {@code commercetools.categories} for Categories and {@code commercetools.product-types} for Product Types.&lt;/p&gt;</span>
<span class="source-line-no">056</span><span id="line.56"> *</span>
<span class="source-line-no">057</span><span id="line.57"> * &lt;p&gt;The grandchild loggers refer to actions. For example, {@code commercetools.categories.request} refers to performing requests via HTTPs to commercetools Composable Commerce for Categories and {@code commercetools.categories.response} refers to the response for Categories. &lt;/p&gt;</span>
<span class="source-line-no">058</span><span id="line.58"> *</span>
<span class="source-line-no">059</span><span id="line.59"> * &lt;p&gt;The logger makes use of different log levels, so for example {@code commercetools.categories.response} logs on debug level the http response from the platform (abbreviated example):&lt;/p&gt;</span>
<span class="source-line-no">060</span><span id="line.60"> *</span>
<span class="source-line-no">061</span><span id="line.61"> * &lt;pre&gt;{@code</span>
<span class="source-line-no">062</span><span id="line.62"> * [OkHttp https://api.europe-west1.gcp.commercetools.com/...] DEBUG commercetools.categories.response - io.vrap.rmf.base.client.ApiHttpResponse@33e37acd[statusCode=200,headers=...,textInterpretedBody={"limit":20,"offset":0,"count":4,"total":4,"results":[{"id":"ca7f64dc-ab41-4e7f-b65b-bfc25bf01111","version":1,"createdAt":"2021-01-06T09:21:55.445Z","lastModifiedAt":"2021-01-06T09:21:55.445Z","key":"random-key-15aab6ee-9a48-4fdc-a8c3-8ff9ff390d60","name":{"key-6bc3cc62-1995-43f4":"value-random-string-c3ff7f1a-6371-4c0c-a3b9-5060eca08b8a"},"slug":{"key-6bc3cc62-1995-43f4":"value-random-string-c3ff7f1a-6371-4c0c-a3b9-5060eca08b8a"},"description":{"key-6bc3cc62-1995-43f4":"value-random-string-c3ff7f1a-6371-4c0c-a3b9-5060eca08b8a"},"ancestors":[],"orderHint":"random-string-a99e6941-3225-4766-923a-4a654652532f","externalId":"random-id-100b3851-29b4-47c1-aef3-860b4cd28f54"}]}]</span>
<span class="source-line-no">063</span><span id="line.63"> * }&lt;/pre&gt;</span>
<span class="source-line-no">064</span><span id="line.64"> *</span>
<span class="source-line-no">065</span><span id="line.65"> * &lt;p&gt;{@code commercetools.categories.response} logs on trace level additional the formatted http response from the API (abbreviated example):&lt;/p&gt;</span>
<span class="source-line-no">066</span><span id="line.66"> *</span>
<span class="source-line-no">067</span><span id="line.67"> * &lt;pre&gt;{@code</span>
<span class="source-line-no">068</span><span id="line.68"> * [OkHttp https://api.europe-west1.gcp.commercetools.com/...] TRACE commercetools.categories.response - 200</span>
<span class="source-line-no">069</span><span id="line.69"> * {</span>
<span class="source-line-no">070</span><span id="line.70"> *   "limit" : 20,</span>
<span class="source-line-no">071</span><span id="line.71"> *   "offset" : 0,</span>
<span class="source-line-no">072</span><span id="line.72"> *   "count" : 4,</span>
<span class="source-line-no">073</span><span id="line.73"> *   "total" : 4,</span>
<span class="source-line-no">074</span><span id="line.74"> *   "results" : [ {</span>
<span class="source-line-no">075</span><span id="line.75"> *     "id" : "bcb15128-b69e-47b6-81c4-1ea5f9a63b83",</span>
<span class="source-line-no">076</span><span id="line.76"> *     "version" : 1,</span>
<span class="source-line-no">077</span><span id="line.77"> *     "lastMessageSequenceNumber" : 1,</span>
<span class="source-line-no">078</span><span id="line.78"> *     "createdAt" : "2021-01-06T09:21:50.485Z",</span>
<span class="source-line-no">079</span><span id="line.79"> *     "lastModifiedAt" : "2021-01-06T09:21:50.485Z",</span>
<span class="source-line-no">080</span><span id="line.80"> *     "createdBy" : {</span>
<span class="source-line-no">081</span><span id="line.81"> *       "clientId" : "h-QvaF3NpsjPBWeXa6TUOnq0",</span>
<span class="source-line-no">082</span><span id="line.82"> *       "isPlatformClient" : false</span>
<span class="source-line-no">083</span><span id="line.83"> *     },</span>
<span class="source-line-no">084</span><span id="line.84"> *     "key" : "random-key-f45535f5-1111-4bfb-98ac-164234ac2c73",</span>
<span class="source-line-no">085</span><span id="line.85"> *     "name" : {</span>
<span class="source-line-no">086</span><span id="line.86"> *       "key-b7d87008-9526-47b3-8b80" : "value-random-string-baf1a1ae-3726-4573-bec5-2c53c7d1114a"</span>
<span class="source-line-no">087</span><span id="line.87"> *     },</span>
<span class="source-line-no">088</span><span id="line.88"> *     "slug" : {</span>
<span class="source-line-no">089</span><span id="line.89"> *       "key-b7d87008-9526-47b3-8b80" : "value-random-string-baf1a1ae-3726-4573-bec5-2c53c7d1114a"</span>
<span class="source-line-no">090</span><span id="line.90"> *     },</span>
<span class="source-line-no">091</span><span id="line.91"> *     "description" : {</span>
<span class="source-line-no">092</span><span id="line.92"> *       "key-b7d87008-9526-47b3-8b80" : "value-random-string-baf1a1ae-3726-4573-bec5-2c53c7d1114a"</span>
<span class="source-line-no">093</span><span id="line.93"> *     },</span>
<span class="source-line-no">094</span><span id="line.94"> *     "ancestors" : [ ],</span>
<span class="source-line-no">095</span><span id="line.95"> *     "orderHint" : "random-string-6b88f299-d4ca-491a-9d7c-3463e718c8d2",</span>
<span class="source-line-no">096</span><span id="line.96"> *     "externalId" : "random-id-b98a5ab4-5413-40b3-8119-eb5ac2b5afbb",</span>
<span class="source-line-no">097</span><span id="line.97"> *     "metaTitle" : {</span>
<span class="source-line-no">098</span><span id="line.98"> *       "key-b7d87008-9526-47b3-8b80" : "value-random-string-baf1a1ae-3726-4573-bec5-2c53c7d1114a"</span>
<span class="source-line-no">099</span><span id="line.99"> *     },</span>
<span class="source-line-no">100</span><span id="line.100"> *     "metaKeywords" : {</span>
<span class="source-line-no">101</span><span id="line.101"> *       "key-b7d87008-9526-47b3-8b80" : "value-random-string-baf1a1ae-3726-4573-bec5-2c53c7d1114a"</span>
<span class="source-line-no">102</span><span id="line.102"> *     },</span>
<span class="source-line-no">103</span><span id="line.103"> *     "metaDescription" : {</span>
<span class="source-line-no">104</span><span id="line.104"> *       "key-b7d87008-9526-47b3-8b80" : "value-random-string-baf1a1ae-3726-4573-bec5-2c53c7d1114a"</span>
<span class="source-line-no">105</span><span id="line.105"> *     }</span>
<span class="source-line-no">106</span><span id="line.106"> *   }, {</span>
<span class="source-line-no">107</span><span id="line.107"> *   ...</span>
<span class="source-line-no">108</span><span id="line.108"> *   } ]</span>
<span class="source-line-no">109</span><span id="line.109"> * }</span>
<span class="source-line-no">110</span><span id="line.110"> * }&lt;/pre&gt;</span>
<span class="source-line-no">111</span><span id="line.111"> *</span>
<span class="source-line-no">112</span><span id="line.112"> * &lt;p&gt;{@code commercetools.products.responses.queries} logs only HTTP GET requests and {@code commercetools.products.responses.commands} logs only HTTP POST/DELETE requests.&lt;/p&gt;</span>
<span class="source-line-no">113</span><span id="line.113"> *</span>
<span class="source-line-no">114</span><span id="line.114"> * &lt;pre&gt;{@code</span>
<span class="source-line-no">115</span><span id="line.115"> * [pool-1-thread-1] DEBUG commercetools.products.request.commands - io.vrap.rmf.base.client.ApiHttpRequest@1d2c6948[method=POST,uri="https://api.europe-west1.gcp.commercetools.com/test-php-dev-integration-1/products",headers=[...],textInterpretedBody={"productType":{"id":"cda39953-23af-4e85-abb0-5b89517ec5f2","typeId":"product-type"},"name":{"random-string-b66de021-d2fa-4262-8837-94a6992a8cdc":"random-string-da28a010-e66b-49d4-a18b-f1bfc145d2f6"},...}]</span>
<span class="source-line-no">116</span><span id="line.116"> * [pool-1-thread-1] DEBUG commercetools.products.request.queries - io.vrap.rmf.base.client.ApiHttpRequest@53667fdb[method=GET,uri="https://api.europe-west1.gcp.commercetools.com/test-php-dev-integration-1/products/ef745227-b115-4132-ba2c-4e46db80df79",headers=[...],textInterpretedBody=empty body]</span>
<span class="source-line-no">117</span><span id="line.117"> * }&lt;/pre&gt;</span>
<span class="source-line-no">118</span><span id="line.118"> *</span>
<span class="source-line-no">119</span><span id="line.119"> * &lt;h2 id=mdc_usage&gt;Usage of Mapped Diagnostic Context&lt;/h2&gt;</span>
<span class="source-line-no">120</span><span id="line.120"> *</span>
<span class="source-line-no">121</span><span id="line.121"> * &lt;p&gt;The SDK uses {@link java.util.concurrent.CompletableFuture CompletableFutures} extensively and the {@link java.util.concurrent.ExecutorService} typically has a thread pool</span>
<span class="source-line-no">122</span><span id="line.122"> * to execute the futures. This could lead to the fact that the future is executed on different threads. In case the {@link org.slf4j.MDC} is used by the application the context</span>
<span class="source-line-no">123</span><span id="line.123"> * could get lost while executing the futures. As the CompletableFutures don't allow attaching a Context you have to make them and the ExecutorService</span>
<span class="source-line-no">124</span><span id="line.124"> * context aware so that they will restore the MDC before executing the future tasks.&lt;/p&gt;</span>
<span class="source-line-no">125</span><span id="line.125"> *</span>
<span class="source-line-no">126</span><span id="line.126"> * &lt;p&gt;The SDK additionally supports the attachment of a {@link io.vrap.rmf.base.client.Context} to a client {@link io.vrap.rmf.base.client.ContextApiHttpClient},</span>
<span class="source-line-no">127</span><span id="line.127"> * the {@link io.vrap.rmf.base.client.ApiHttpRequest} and the {@link io.vrap.rmf.base.client.ApiHttpResponse} by implementing the</span>
<span class="source-line-no">128</span><span id="line.128"> * {@link io.vrap.rmf.base.client.ContextAware} interface&lt;/p&gt;</span>
<span class="source-line-no">129</span><span id="line.129"> *</span>
<span class="source-line-no">130</span><span id="line.130"> * &lt;p&gt;The {@link com.commercetools.api.client.ProjectApiRoot} also allows to add a {@link io.vrap.rmf.base.client.Context} to it. This is useful</span>
<span class="source-line-no">131</span><span id="line.131"> * to create a context aware root from a global instance when needed.&lt;/p&gt;</span>
<span class="source-line-no">132</span><span id="line.132"> *</span>
<span class="source-line-no">133</span><span id="line.133"> * {@include.example example.ExamplesTest#mdcProjectApiRoot()}</span>
<span class="source-line-no">134</span><span id="line.134"> *</span>
<span class="source-line-no">135</span><span id="line.135"> * &lt;p&gt;The above example creates a {@link io.vrap.rmf.base.client.MDCContext} and take a copy of the MDC. The ApiHttpClient will be wrapped in a ContextApiHttpClient</span>
<span class="source-line-no">136</span><span id="line.136"> * and set the context to all requests and responses executed.&lt;/p&gt;</span>
<span class="source-line-no">137</span><span id="line.137"> *</span>
<span class="source-line-no">138</span><span id="line.138"> * &lt;p&gt;The {@link io.vrap.rmf.base.client.http.InternalLoggerMiddleware} will restore the MDC before logging and clean up afterwards to avoid</span>
<span class="source-line-no">139</span><span id="line.139"> * pollution of threads with unrelated context data. The same applies for the {@link com.commercetools.api.client.ConcurrentModificationMiddleware}&lt;/p&gt;</span>
<span class="source-line-no">140</span><span id="line.140"> *</span>
<span class="source-line-no">141</span><span id="line.141"> * &lt;p&gt;The usage of the {@link io.vrap.rmf.base.client.Context} object in the SDK allows further extensions to transport request related context data e.g.</span>
<span class="source-line-no">142</span><span id="line.142"> * for telemetry purposes.&lt;/p&gt;</span>
<span class="source-line-no">143</span><span id="line.143"> */</span>
<span class="source-line-no">144</span><span id="line.144">public class Logging {</span>
<span class="source-line-no">145</span><span id="line.145">}</span>




























































</pre>
</div>
</main>
</body>
</html>
